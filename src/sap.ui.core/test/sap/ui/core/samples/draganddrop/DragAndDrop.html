<!DOCTYPE html>
<html>
<head>
<meta http-equiv='X-UA-Compatible' content='IE=edge'>
<meta http-equiv='Content-Type' content='text/html;charset=UTF-8'>
<title>Drag and Drop</title>
<script id='sap-ui-bootstrap'
	src='../../../../../../resources/sap-ui-core.js'
	data-sap-ui-xx-bindingSyntax="complex"
	data-sap-ui-theme="sap_belize"
	data-sap-ui-libs="sap.m"></script>

<script>
var oData = {
	game: [
		{icon: "favorite", desc: "Star", random: Math.random(), dropped: false},
		{icon: "umbrella", desc: "Umbrella", random: Math.random(), dropped: false},
		{icon: "flight", desc: "Plane", random: Math.random(), dropped: false},
		{icon: "wrench", desc: "Wrench", random: Math.random(), dropped: false},
		{icon: "globe", desc: "Globe", random: Math.random(), dropped: false}
	]
};

var oModel = new sap.ui.model.json.JSONModel();
oModel.setData(oData);
sap.ui.getCore().setModel(oModel);

var DraggableListItem = sap.m.StandardListItem.extend("my.DraggableListItem", {
	metadata : {
		aggregations : {
			dragDropConfig : {name : "dragDropConfig", type : "sap.ui.core.dnd.DragDropBase", multiple : true}
		}
	},
	renderer: {}
});

var oIconList = new sap.m.List({
	headerText: "Icons",
	noDataText: "Well Done!",
	width: "15rem",
	inset: true
}).bindItems({
	path: "/game",
	sorter: new sap.ui.model.Sorter("random"),
	filters : new sap.ui.model.Filter("dropped", "EQ", false),
	template: new DraggableListItem({
		icon: "sap-icon://{icon}",
		highlight: "Information",
		dragDropConfig: new sap.ui.core.dnd.DragInfo({
			groupName: "{icon}"
		})
	})
});

var oDescList = new sap.m.List({
	headerText: "Descriptions",
	width: "15rem",
	inset: true,
	dragDropConfig: [
		new sap.ui.core.dnd.DragInfo({
			groupName: "Descriptions",
			sourceAggregation: "items"
		}),
		new sap.ui.core.dnd.DropInfo({
			groupName: "Descriptions",
			targetAggregation: "items",
			dropPosition: "Between",
			drop: function(oEvent) {
				var sDropPosition = oEvent.getParameter("dropPosition");
				var oDraggedControl = oEvent.getParameter("draggedControl");
				var oDroppedControl = oEvent.getParameter("droppedControl");

				sap.m.MessageToast.show(oDraggedControl.getTitle() + " is dropped " + sDropPosition + " the " + oDroppedControl.getTitle());
			}
		})
	]
}).bindItems({
	path: "/game",
	template: new DraggableListItem({
		title: "{desc}",
		highlight: {
			parts: [{path : 'dropped'}],
			formatter: function(bDropped) {
				if (bDropped) {
					return "Success";
				}
				return "Warning";
			}
		},
		icon: {
			parts: [{path : 'icon'}, {path : 'dropped'}],
			formatter: function(sIcon, bDropped) {
				return bDropped ? "sap-icon://" + sIcon : "";
			}
		},
		dragDropConfig: new sap.ui.core.dnd.DropInfo({
			groupName: "{icon}",
			drop: function(oEvent) {
				var oDraggedControl = oEvent.getParameter("draggedControl");
				var oDraggedContext = oDraggedControl.getBindingContext();
				oModel.setProperty("dropped", true, oDraggedContext);
				oModel.refresh(true);
			}
		})
	})
});


var oGameHBox = new sap.m.HBox({
	items : [oIconList, oDescList],
	renderType: "Bare"
});

var oPage = new sap.m.Page({
	title: "Drag And Drop Test Page",
	content : [oGameHBox]
});

var oApp = new sap.m.App({
	pages: [oPage]
}).placeAt("content");

</script>

</head>
<body class="sapUiBody" id="content">
</body>
</html>